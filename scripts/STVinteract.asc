#pragma require "STVutil.asc"

#include "STVutil.asc"

int defaultInteractionTile = 118;

class Interaction
{
    int textID;
    int interactionTile;

    Vector2@ offset;

    bool overlapping = true;

    int x, y;

    Interaction(
        int textID, Vector2@ offset = Vector2(0, -32),
        int interactionTile = defaultInteractionTile
    ) {
        this.textID = textID;
        this.interactionTile = interactionTile;
        @this.offset = offset;

        for (int x = 1; x < 255; x++) {
            for(int y = 1; y < 64; y++) {
                if (jjEventGet(x, y) == AREA::TEXT) { 
                    if(jjParameterGet(x, y, 0, 8) == textID) {                        
                        this.x = x * 32;
                        this.y = y * 32;
                    }
                }
            }
        }
    }

    void update(jjPLAYER@ player) {

    }

    void draw(jjCANVAS@ canvas) {
        if(overlapping) {
            canvas.drawTile(this.x + this.offset.x, this.y + this.offset.y, this.interactionTile);
        }
    }
};

array<Interaction@> interactions;

void registerInteraction(Interaction@ interaction) {
    interactions.insertLast(interaction);
}

void updateInteractions(jjPLAYER@ player) {
    for (uint i = 0; i < interactions.length; i++)
    {
        Interaction@ interaction = interactions[i];
        interaction.update(player);
    }
}

void drawInteractions(jjCANVAS@ canvas) {
    for (uint i = 0; i < interactions.length; i++)
    {
        Interaction@ interaction = interactions[i];
        interaction.draw(canvas);
    }
}